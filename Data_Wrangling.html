

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Data wrangling &#8212; ICESat-2 Sea Ice Data Analysis and Visualization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Utils" href="utils_notebook.html" />
    <link rel="prev" title="Sea ice drift" href="Drift.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ICESat-2 Sea Ice Data Analysis and Visualization</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  NOTEBOOKS
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Maps.html">
   Data visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Restrict_Regionally.html">
   Restrict data regionally
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Compare_Means.html">
   Winter 18-19 vs. winter 19-20 comparison
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Thickness_And_Type.html">
   Sea ice growth: thickness &amp; type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PIOMAS.html">
   Historical ice thickness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Drift.html">
   Sea ice drift
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  MISC
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="utils_notebook.html">
   Utils
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Data_Wrangling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/nicolejkeeney/icesat2-book/blob/master/Data_Wrangling.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-notebook-dependencies">
   Import notebook dependencies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-filepaths">
   Define filepaths
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-in-data">
   Load in data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#icesat-2-monthly-gridded-sea-ice-data">
     ICESat-2 monthly gridded sea ice data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-sea-ice-concentration-data">
     NSIDC sea ice concentration data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clean-data">
       Clean data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nsidc-region-mask-for-the-arctic-data">
     NSIDC region mask for the Arctic data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#define-descriptive-information">
       Define descriptive information
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#era5-climate-reanalysis-data">
     ERA5 climate reanalysis data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Clean data
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interpolate-missing-icesat-2-data">
   Interpolate missing ICESat-2 data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-descriptive-attributes-coordinates-to-all-icesat-2-variables">
     Add descriptive attributes &amp; coordinates to all ICESat-2 variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regrid-era5-data-to-icesat-2-grid">
   Regrid ERA5 data to ICESat-2 grid
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-data-variables-of-interest">
     Choose data variables of interest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regrid-era5-data-add-to-icesat-2-dataset">
     Regrid ERA5 data &amp; add to ICESat-2 dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compile-datasets-into-a-single-dataset">
   Compile datasets into a single Dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#save-dataset-to-your-local-machine">
   Save dataset to your local machine
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-wrangling">
<h1>Data wrangling<a class="headerlink" href="#data-wrangling" title="Permalink to this headline">¶</a></h1>
<p>This notebook loads the different datasets used in the analysis into a single NETCDF4 file, with descriptive attributes maintained for each dataset. The datasets used in this notebook are listed below. The output file is accessible in the google bucket for this jupyter book and loaded in each notebook.</p>
<p><strong>Input</strong>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://icesat-2.gsfc.nasa.gov/sea-ice-thickness-data">ICESat-2 monthly gridded sea ice data</a></p></li>
<li><p><a class="reference external" href="https://nsidc.org/data/g02202">Monthly NSIDC sea ice concentration data</a></p></li>
<li><p><a class="reference external" href="https://nsidc.org/data/polar-stereo/tools_masks.html#region_masks">NSIDC region mask</a> and <a class="reference external" href="https://nsidc.org/data/polar-stereo/tools_geo_pixel.html">coordinate</a> tools (psn25 v3)</p></li>
<li><p><a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#%21/dataset/reanalysis-era5-single-levels-monthly-means?tab=overview">ERA 5 climate renanalysis data</a></p></li>
</ul>
<p><strong>Output</strong>:</p>
<ul class="simple">
<li><p>NETCDF4 file</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This notebook is <strong>NOT</strong> configured to run in Google Colab. This file generated by this notebook is also provided google bucket for this book. <a class="reference external" href="https://storage.googleapis.com/icesat2-book-data/icesat2-book-dataset.nc">Click here</a> to download the dataset.</p>
</div>
<div class="section" id="import-notebook-dependencies">
<h2>Import notebook dependencies<a class="headerlink" href="#import-notebook-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import os
import numpy as np
import numpy.ma as ma
import xarray as xr
import pandas as pd
import scipy.interpolate
import pyproj
from datetime import date

# Ignore warnings in the notebook to improve display
# You might want to remove this when debugging/writing new code
import warnings
warnings.filterwarnings(&#39;ignore&#39;)

#import utils function from google bucket 
!gsutil cp gs://icesat2-book-data/utils.py ./
import utils
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-filepaths">
<h2>Define filepaths<a class="headerlink" href="#define-filepaths" title="Permalink to this headline">¶</a></h2>
<p>Define filepaths to data on your local machine</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#path to data directory</span>
<span class="n">localDirectory</span> <span class="o">=</span> <span class="s1">&#39;/Users/nicolekeeney/Desktop/notebook_data/&#39;</span>

<span class="c1">#path to monthly gridded ICESat-2 data</span>
<span class="n">IS2_path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="s1">&#39;cpom_thickness/&#39;</span> 

<span class="c1">#path to NSIDC weekly sea ice concentration data</span>
<span class="n">SIC_path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="s1">&#39;SIC/&#39;</span>

<span class="c1">#path to NSIDC region mask for the Arctic</span>
<span class="n">regionMask_path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="s1">&#39;regionMask/&#39;</span>

<span class="c1">#path to ERA5 climate reanalysis data </span>
<span class="n">ERA5_filename</span> <span class="o">=</span> <span class="s1">&#39;adaptor.mars.internal-1593801470.6369596-17327-1-b6ff618a-cfd2-4a13-9eb8-87c048affbf2.nc&#39;</span>
<span class="n">ERA5_path</span> <span class="o">=</span> <span class="n">localDirectory</span>  <span class="o">+</span> <span class="s1">&#39;ERA5/&#39;</span> <span class="o">+</span> <span class="n">ERA5_filename</span>

<span class="c1">#path to PIOMAS data</span>
<span class="n">PIOMAS_path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="s1">&#39;PIOMAS_monthly_thickness/&#39;</span>

<span class="c1">#path to NSIDC sea ice drift data </span>
<span class="n">drift_path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="s1">&#39;drifts/&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-in-data">
<h2>Load in data<a class="headerlink" href="#load-in-data" title="Permalink to this headline">¶</a></h2>
<p>Data is loaded into notebook using functions from Nicole’s utils.py script</p>
<ul class="simple">
<li><p>See <a class="reference external" href="https://nicolejkeeney.github.io/icesat2_intern_book/utils_notebook.html">utils</a> chapter for more infomation on functions used</p></li>
</ul>
<p>Set desired date range for data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">startYear</span> <span class="o">=</span> <span class="mi">2018</span>
<span class="n">endYear</span> <span class="o">=</span> <span class="mi">2020</span>
<span class="n">winters</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getWinterDateRange</span><span class="p">(</span><span class="n">startYear</span><span class="p">,</span> <span class="n">endYear</span><span class="p">)</span> <span class="c1">#get date range for winter 18-19 and winter 19-20</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="icesat-2-monthly-gridded-sea-ice-data">
<h3>ICESat-2 monthly gridded sea ice data<a class="headerlink" href="#icesat-2-monthly-gridded-sea-ice-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#load dataset </span>
<span class="n">is2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getIS2Data</span><span class="p">(</span><span class="n">IS2_path</span><span class="p">,</span> <span class="n">winters</span><span class="p">)</span>

<span class="c1">#drop projection variable </span>
<span class="n">is2</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">)</span>

<span class="c1">#get lat and lon</span>
<span class="n">is2Lats</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">is2Lons</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">is2LonsAttrs</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span> 
<span class="n">is2LatsAttrs</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span>

<span class="c1">#assign lat and lon as coordinates to dataset</span>
<span class="n">is2</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lons</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="nsidc-sea-ice-concentration-data">
<h3>NSIDC sea ice concentration data<a class="headerlink" href="#nsidc-sea-ice-concentration-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sic</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getSICData</span><span class="p">(</span><span class="n">SIC_path</span><span class="p">,</span> <span class="n">winters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="clean-data">
<h4>Clean data<a class="headerlink" href="#clean-data" title="Permalink to this headline">¶</a></h4>
<p>Clean data by removing flagged data and filling the pole hole. We assume concentration is 100% within the pole hole because we are only looking at winter data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#remove flagged data </span>
<span class="n">sic_monthly_cdr</span> <span class="o">=</span> <span class="n">sic</span><span class="p">[</span><span class="s1">&#39;seaice_conc_monthly_cdr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sic</span><span class="p">[</span><span class="s1">&#39;seaice_conc_monthly_cdr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1">#fill pole hole as 100% concentration</span>
<span class="n">sic_monthly_cdr</span> <span class="o">=</span> <span class="n">sic</span><span class="p">[</span><span class="s1">&#39;seaice_conc_monthly_cdr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sic</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#reassign variable</span>
<span class="n">sic</span> <span class="o">=</span> <span class="n">sic</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">seaice_conc_monthly_cdr</span> <span class="o">=</span> <span class="n">sic_monthly_cdr</span><span class="p">)</span>

<span class="c1">#reassign dimensions </span>
<span class="n">seaice_conc_monthly_cdr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">sic</span><span class="p">[</span><span class="s1">&#39;seaice_conc_monthly_cdr&#39;</span><span class="p">],</span> <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">winters</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lons</span><span class="p">)})</span> 

<span class="c1">#attributes from entire NSIDC data to maintain</span>
<span class="n">desiredSICAttrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor_name&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">]</span> <span class="c1">#attributes to maintain from entire sea ice concentration dataset</span>
<span class="n">SICDatasetAttrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">sic</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">desiredSICAttrs</span><span class="p">}</span>
<span class="n">seaice_conc_monthly_cdr</span> <span class="o">=</span> <span class="n">seaice_conc_monthly_cdr</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">SICDatasetAttrs</span><span class="p">)</span>

<span class="c1">#add to is2 dataset </span>
<span class="n">is2</span><span class="p">[</span><span class="s1">&#39;seaice_conc_monthly_cdr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seaice_conc_monthly_cdr</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="nsidc-region-mask-for-the-arctic-data">
<h3>NSIDC region mask for the Arctic data<a class="headerlink" href="#nsidc-region-mask-for-the-arctic-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">regionMask</span><span class="p">,</span> <span class="n">maskLons</span><span class="p">,</span> <span class="n">maskLats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getRegionMask</span><span class="p">(</span><span class="n">regionMask_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-descriptive-information">
<h4>Define descriptive information<a class="headerlink" href="#define-descriptive-information" title="Permalink to this headline">¶</a></h4>
<p>These variables will be used later for creating the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#coords and attributes for Region Mask</span>
<span class="n">regionMaskCoords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;region_mask&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">regionMask</span><span class="p">)}</span>
<span class="n">regionMaskKeys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">])</span>
<span class="n">regionMaskLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;non-region oceans&#39;</span><span class="p">,</span> <span class="s1">&#39;Sea of Okhotsk and Japan&#39;</span><span class="p">,</span><span class="s1">&#39;Bering Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Hudson Bay&#39;</span><span class="p">,</span><span class="s1">&#39;Gulf of St. Lawrence&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Baffin Bay, Davis Strait &amp; Labrador Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Greenland Sea&#39;</span><span class="p">,</span> <span class="s1">&#39;Barents Seas&#39;</span><span class="p">,</span><span class="s1">&#39;Kara Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Laptev Sea&#39;</span><span class="p">,</span><span class="s1">&#39;East Siberian Sea&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Chukchi Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Beaufort Sea&#39;</span><span class="p">,</span><span class="s1">&#39;Canadian Archipelago&#39;</span><span class="p">,</span><span class="s1">&#39;Arctic Ocean&#39;</span><span class="p">,</span><span class="s1">&#39;Land&#39;</span><span class="p">,</span><span class="s1">&#39;Coast&#39;</span><span class="p">])</span>
<span class="n">regionMaskAttrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;NSIDC region mask for the Arctic&#39;</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">regionMaskKeys</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span> <span class="p">:</span> <span class="n">regionMaskLabels</span><span class="p">,</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;keys and labels ordered to match by index&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="era5-climate-reanalysis-data">
<h3>ERA5 climate reanalysis data<a class="headerlink" href="#era5-climate-reanalysis-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERA5</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">ERA5_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h4>Clean data<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Clean data by removing unneccessary variables and converting temperature to Celcius</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#remove unneeded expver variable. </span>
<span class="c1">#for more info on the exper variable, see https://confluence.ecmwf.int/pages/viewpage.action?pageId=173385064</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">expver</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;expver&#39;</span><span class="p">)</span>

<span class="c1">#select data from past two winters </span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getWinterDateRange</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">2020</span><span class="p">))</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getWinterDateRange</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">2020</span><span class="p">))</span>

<span class="c1">#convert t2m temp to celcius </span>
<span class="n">tempCelcius</span> <span class="o">=</span> <span class="n">ERA5</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">283.15</span>
<span class="n">tempCelcius</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="c1">#change units attribute to C (Celcius)</span>
<span class="n">tempCelcius</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2 meter temperature&#39;</span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">t2m</span> <span class="o">=</span> <span class="n">tempCelcius</span><span class="p">)</span> <span class="c1">#add to dataset as a new data variable</span>

<span class="c1">#add descriptive attributes </span>
<span class="n">ERA5</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;era5 monthly averaged data on single levels from 1979 to present&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;website&#39;</span><span class="p">:</span> <span class="s1">&#39;https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels-monthly-means?tab=overview&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;contact&#39;</span><span class="p">:</span> <span class="s1">&#39;copernicus-support@ecmwf.int&#39;</span><span class="p">,</span>
             <span class="s1">&#39;citation&#39;</span><span class="p">:</span> <span class="s1">&#39;Copernicus Climate Change Service (C3S) (2017): ERA5: Fifth generation of ECMWF atmospheric reanalyses of the global climate . Copernicus Climate Change Service Climate Data Store (CDS), July 2020. https://cds.climate.copernicus.eu/cdsapp#!/home&#39;</span><span class="p">}</span>

<span class="c1">#restrict ERA5 data to the Arctic </span>
<span class="n">ERA5</span> <span class="o">=</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="interpolate-missing-icesat-2-data">
<h2>Interpolate missing ICESat-2 data<a class="headerlink" href="#interpolate-missing-icesat-2-data" title="Permalink to this headline">¶</a></h2>
<p>Interpolate missing ICESat-2 data using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.griddata.html">scipy.griddata.interpolate</a> function and add as data variables to the dataset. Because ICESat-2 doesn’t provide full monthly coverage, interpolating fills missing grid cells with a best guess based on surrounding data. This helps avoid sampling biases when performing time series analyses, with the cavaet that this interpolation method is subjective.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#list of variables to interpolate</span>
<span class="n">IS2VarList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ice_type&#39;</span><span class="p">,</span><span class="s1">&#39;ice_thickness&#39;</span><span class="p">,</span><span class="s1">&#39;snow_depth&#39;</span><span class="p">,</span><span class="s1">&#39;freeboard&#39;</span><span class="p">,</span><span class="s1">&#39;ice_thickness_unc&#39;</span><span class="p">,</span><span class="s1">&#39;snow_density&#39;</span><span class="p">,</span><span class="s1">&#39;ice_density&#39;</span><span class="p">]</span>

<span class="c1">#go through variables in list and add as new data variables to ICESat-2 dataset</span>
<span class="k">for</span> <span class="n">varStr</span> <span class="ow">in</span> <span class="n">IS2VarList</span><span class="p">:</span>
    
    <span class="c1">#empty list to store monthly interpolated data </span>
    <span class="n">varFilled</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">is2</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span> 
        <span class="c1">#current month of data </span>
        <span class="n">monthlyVar</span> <span class="o">=</span> <span class="n">is2</span><span class="p">[</span><span class="n">varStr</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">month</span><span class="p">]</span>
        
        <span class="c1">#additional condition for interpolating ice thickness</span>
        <span class="k">if</span> <span class="n">varStr</span> <span class="o">==</span> <span class="s1">&#39;ice_thickness&#39;</span><span class="p">:</span> 
            <span class="c1">#if var is ice_thickness_int, set ice_thickness to zero if ice_thickness is NaN and sea ice concentration &lt; 15%</span>
            <span class="n">monthlyVar</span><span class="p">[</span><span class="n">seaice_conc_monthly_cdr</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">month</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1">#conditions for cells to interpolate</span>
        <span class="n">monthlyVar</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">monthlyVar</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">regionMask</span> <span class="o">!=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">regionMask</span> <span class="o">!=</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">seaice_conc_monthly_cdr</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">month</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">),</span> <span class="n">monthlyVar</span><span class="p">)</span>
        
        <span class="c1">#append interpolated data to list </span>
        <span class="n">varFilled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="n">is2Lons</span><span class="p">[</span><span class="o">~</span><span class="n">monthlyVar</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="n">is2Lats</span><span class="p">[</span><span class="o">~</span><span class="n">monthlyVar</span><span class="o">.</span><span class="n">mask</span><span class="p">]),</span> 
                    <span class="n">monthlyVar</span><span class="p">[</span><span class="o">~</span><span class="n">monthlyVar</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),(</span><span class="n">is2Lons</span><span class="p">,</span> <span class="n">is2Lats</span><span class="p">),</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span><span class="p">))</span>
    
    <span class="c1">#convert varFilled to a DataArray object </span>
    <span class="n">varFilledDataArray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">varFilled</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">is2</span><span class="p">[</span><span class="n">varStr</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">varFilledDataArray</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;note&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;interpolated from original data&#39;</span>
    
    <span class="c1">#add as new data variable to ICESat-2 dataset</span>
    <span class="n">is2</span><span class="p">[</span><span class="n">varStr</span> <span class="o">+</span> <span class="s1">&#39;_filled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">varFilledDataArray</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-descriptive-attributes-coordinates-to-all-icesat-2-variables">
<h3>Add descriptive attributes &amp; coordinates to all ICESat-2 variables<a class="headerlink" href="#add-descriptive-attributes-coordinates-to-all-icesat-2-variables" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#assign ICESat-2 dataset attributes to all variables </span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">is2</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
    <span class="n">is2</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">is2</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">is2</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

<span class="c1">#drop lat and lon as data variables and add as coordinate values </span>
<span class="n">is2</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lons</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="regrid-era5-data-to-icesat-2-grid">
<h2>Regrid ERA5 data to ICESat-2 grid<a class="headerlink" href="#regrid-era5-data-to-icesat-2-grid" title="Permalink to this headline">¶</a></h2>
<p>In order to merge ERA5 data to the same dataset as ICESat-2, it needs to be on the same grid.</p>
<div class="section" id="choose-data-variables-of-interest">
<h3>Choose data variables of interest<a class="headerlink" href="#choose-data-variables-of-interest" title="Permalink to this headline">¶</a></h3>
<p>ERA5 provides climate reananalysis data for many different variables. Here, choose data variables to maintain in the final gridded data product.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERA5Vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">,</span><span class="s1">&#39;msdwlwrf&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;chosen variables: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ERA5Vars</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>chosen variables: 2 meter temperature, Mean surface downward long-wave radiation flux
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="regrid-era5-data-add-to-icesat-2-dataset">
<h3>Regrid ERA5 data &amp; add to ICESat-2 dataset<a class="headerlink" href="#regrid-era5-data-add-to-icesat-2-dataset" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#map projection from ICESat-2 data (can be viewed in is2.projection.attrs[&#39;srid&#39;])</span>
<span class="n">IS2_proj</span> <span class="o">=</span> <span class="s1">&#39;EPSG:3411&#39;</span>

<span class="c1">#initialize map projection and project data to it</span>
<span class="n">mapProj</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="s2">&quot;+init=&quot;</span> <span class="o">+</span> <span class="n">IS2_proj</span><span class="p">)</span>
<span class="n">xptsERA</span><span class="p">,</span> <span class="n">yptsERA</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ERA5</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span> <span class="o">=</span> <span class="n">mapProj</span><span class="p">(</span><span class="n">is2Lons</span><span class="p">,</span> <span class="n">is2Lats</span><span class="p">)</span>

<span class="c1">#grid data</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ERA5Vars</span><span class="p">:</span> 
    <span class="n">ERA5gridded</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span> 
        <span class="n">monthlyGriddedERA5</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="n">xptsERA</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">yptsERA</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">(</span><span class="n">xptsIS2</span><span class="p">,</span> <span class="n">yptsIS2</span><span class="p">),</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">ERA5gridded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monthlyGriddedERA5</span><span class="p">)</span>
    
    <span class="c1">#create xarray DataArray object with descriptive coordinates </span>
    <span class="n">ERAArray</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">ERA5gridded</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lats</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">is2Lons</span><span class="p">)})</span>
    <span class="n">ERAArray</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">ERA5</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
    <span class="n">ERAArray</span> <span class="o">=</span> <span class="n">ERAArray</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">ERA5</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

    <span class="c1">#add to ICESat-2 dataset</span>
    <span class="n">is2</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ERAArray</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="compile-datasets-into-a-single-dataset">
<h2>Compile datasets into a single Dataset<a class="headerlink" href="#compile-datasets-into-a-single-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#add region mask as coordinate to dataset</span>
<span class="n">is2</span> <span class="o">=</span> <span class="n">is2</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="n">regionMaskCoords</span><span class="p">)</span>

<span class="c1">#add descriptive attributes </span>
<span class="n">is2</span><span class="o">.</span><span class="n">region_mask</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">regionMaskAttrs</span>
<span class="n">is2</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">is2LonsAttrs</span>
<span class="n">is2</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">is2LatsAttrs</span>
<span class="n">is2</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span><span class="s1">&#39;data used in nicolejkeeney ICESat-2 jupyter book&#39;</span><span class="p">,</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;see individual data variables for references&#39;</span><span class="p">,</span> <span class="s1">&#39;creation date&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">is2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:                   (time: 12, x: 448, y: 304)
Coordinates:
  * time                      (time) datetime64[ns] 2018-11-01 ... 2020-04-01
    longitude                 (x, y) float32 168.32042 168.14876 ... -9.998976
    latitude                  (x, y) float32 31.102673 31.199413 ... 34.472084
    region_mask               (x, y) uint8 1 1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1 1
Dimensions without coordinates: x, y
Data variables:
    xgrid                     (time, x, y) float32 -3837500.0 ... 3737500.0
    ygrid                     (time, x, y) float32 5837500.0 ... -5337500.0
    ice_thickness             (time, x, y) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
    ice_thickness_int         (time, x, y) float32 nan nan nan ... nan nan nan
    ice_thickness_unc         (time, x, y) float32 nan nan nan ... nan nan nan
    num_segments              (time, x, y) float32 nan nan nan ... nan nan nan
    mean_day_of_month         (time, x, y) float32 nan nan nan ... nan nan nan
    snow_depth                (time, x, y) float32 nan nan nan ... nan nan nan
    snow_density              (time, x, y) float32 nan nan nan ... nan nan nan
    freeboard                 (time, x, y) float32 nan nan nan ... nan nan nan
    ice_type                  (time, x, y) float32 nan nan nan ... nan nan nan
    ice_density               (time, x, y) float32 nan nan nan ... nan nan nan
    seaice_conc_monthly_cdr   (time, x, y) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
    ice_type_filled           (time, x, y) float32 nan nan nan ... nan nan nan
    ice_thickness_filled      (time, x, y) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
    snow_depth_filled         (time, x, y) float32 nan nan nan ... nan nan nan
    freeboard_filled          (time, x, y) float32 nan nan nan ... nan nan nan
    ice_thickness_unc_filled  (time, x, y) float32 nan nan nan ... nan nan nan
    snow_density_filled       (time, x, y) float32 nan nan nan ... nan nan nan
    ice_density_filled        (time, x, y) float32 nan nan nan ... nan nan nan
    t2m                       (time, x, y) float32 nan nan nan ... nan nan nan
    msdwlwrf                  (time, x, y) float32 nan nan nan ... nan nan nan
Attributes:
    description:    data used in nicolejkeeney ICESat-2 jupyter book
    note:           see individual data variables for references
    creation date:  2020-08-28
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-dataset-to-your-local-machine">
<h2>Save dataset to your local machine<a class="headerlink" href="#save-dataset-to-your-local-machine" title="Permalink to this headline">¶</a></h2>
<p>We will use this dataset in other notebooks to plot and analyze the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;icesat2-book-dataset.nc&#39;</span>
<span class="n">is2</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">localDirectory</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;NETCDF4&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39; saved to directory &#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">localDirectory</span><span class="p">)</span>
<span class="n">is2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>File &quot;icesat2-book-dataset.nc&quot; saved to directory &quot;/Users/nicolekeeney/Desktop/notebook_data/&quot;
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "is2intenv"
        },
        kernelOptions: {
            kernelName: "is2intenv",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'is2intenv'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Drift.html" title="previous page">Sea ice drift</a>
    <a class='right-next' id="next-link" href="utils_notebook.html" title="next page">Utils</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Nicole Keeney<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            <div>
    [ICESat-2 mission](https://icesat-2.gsfc.nasa.gov/)
</div>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>